(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{502:function(s,a,n){"use strict";n.r(a);var e=n(21),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h4",{attrs:{id:"复制集机制及原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#复制集机制及原理"}},[s._v("#")]),s._v(" 复制集机制及原理")]),s._v(" "),n("p",[s._v("MongoDB 复制集的主要意义在于实现服务高可用")]),s._v(" "),n("p",[s._v("它的现实依赖于两个方面的功能：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("数据写入时将数据迅速复制到另一个独立节点上\n\n在接受写入的节点发生故障时自动选举出一个新的替代节点\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("在实现高可用的同时，复制集实现了其他几个附加作用：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("数据分发：将数据从一个区域复制到另一个区域，减少另一个区域的读延迟\n\n读写分离：不同类型的压力分别在不同的节点上执行\n\n异地容灾：在数据中心故障时候快速切换到异地\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"典型复制集结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#典型复制集结构"}},[s._v("#")]),s._v(" 典型复制集结构")]),s._v(" "),n("p",[s._v("一个典型的复制集由3个以上具有投票权的节点组成，包括：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("一个主节点（PRIMARY）：接受写入操作和选举时投票\n\n两个（或多个）从节点（SECONDARY）：复制主节点上的新数据和选举时投票\n\n不推荐使用 Arbiter（投票节点）\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("img",{attrs:{src:"/mongodb/mongo-jiqun.png",alt:"image"}})]),s._v(" "),n("h4",{attrs:{id:"数据是如何复制的"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据是如何复制的"}},[s._v("#")]),s._v(" 数据是如何复制的？")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("当一个修改操作，无论是插入、更新或删除，到达主节点时，它对数据的操作将被\n记录下来（经过一些必要的转换），这些记录称为 oplog。\n\n从节点通过在主节点上打开一个 tailable 游标不断获取新进入主节点的 oplog，并\n在自己的数据上回放，以此保持跟主节点的数据一致。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("img",{attrs:{src:"/mongodb/mongo-jiqun2.png",alt:"image"}})]),s._v(" "),n("h4",{attrs:{id:"通过选举完成故障恢复"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通过选举完成故障恢复"}},[s._v("#")]),s._v(" 通过选举完成故障恢复")]),s._v(" "),n("p",[n("img",{attrs:{src:"/mongodb/mongo-jiqun3.png",alt:"image"}})]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("具有投票权的节点之间两两互相发送心跳；\n\n当5次心跳未收到时判断为节点失联；\n\n如果失联的是主节点，从节点会发起选举，选出新的主节点；\n\n如果失联的是从节点则不会产生新的选举；\n\n选举基于 RAFT一致性算法 实现，选举成功的必要条件是大多数投票节点存活；\n\n复制集中最多可以有50个节点，但具有投票权的节点最多7个。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h4",{attrs:{id:"影响选举的因素"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#影响选举的因素"}},[s._v("#")]),s._v(" 影响选举的因素")]),s._v(" "),n("p",[s._v("整个集群必须有大多数节点存活；")]),s._v(" "),n("p",[s._v("被选举为主节点的节点必须：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("能够与多数节点建立连接\n具有较新的 oplog\n具有较高的优先级（如果有配置）\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h4",{attrs:{id:"常见选项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见选项"}},[s._v("#")]),s._v(" 常见选项")]),s._v(" "),n("p",[s._v("复制集节点有以下常见的选配项：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("是否具有投票权（v 参数）：有则参与投票；\n优先级（priority 参数）：优先级越高的节点越优先成为主节点。优先级为0的节点无法成\n为主节点；\n隐藏（hidden 参数）：复制数据，但对应用不可见。隐藏节点可以具有投票仅，但优先\n级必须为0；\n延迟（slaveDelay 参数）：复制 n 秒之前的数据，保持与主节点的时间差。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("img",{attrs:{src:"/mongodb/mongo-jiqun4.png",alt:"image"}})]),s._v(" "),n("h4",{attrs:{id:"复制集注意事项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#复制集注意事项"}},[s._v("#")]),s._v(" 复制集注意事项")]),s._v(" "),n("p",[s._v("关于硬件：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("因为正常的复制集节点都有可能成为主节点，它们的地位是一样的，因此硬件配置上必须\n一致；\n\n为了保证节点不会同时宕机，各节点使用的硬件必须具有独立性。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("关于软件：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("复制集各节点软件版本必须一致，以避免出现不可预知的问题。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("增加节点不会增加系统写性能！")])])}),[],!1,null,null,null);a.default=t.exports}}]);