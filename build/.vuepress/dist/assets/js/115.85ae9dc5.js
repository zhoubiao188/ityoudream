(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{559:function(s,t,a){"use strict";a.r(t);var n=a(21),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"基于redis的微博计算好友关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于redis的微博计算好友关系"}},[s._v("#")]),s._v(" 基于Redis的微博计算好友关系")]),s._v(" "),a("h3",{attrs:{id:"一、计算好友关系业务场景分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、计算好友关系业务场景分析"}},[s._v("#")]),s._v(" 一、计算好友关系业务场景分析")]),s._v(" "),a("p",[s._v("微博微关系：\n共同关注：是计算出周標和马化腾共同关注的人有哪些？\n我关注的人也关注他：是计算出我周標关注的人群中，有哪些人同时和我一样关注了马化腾")]),s._v(" "),a("h3",{attrs:{id:"二、计算好友关系的redis技术方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、计算好友关系的redis技术方案"}},[s._v("#")]),s._v(" 二、计算好友关系的redis技术方案")]),s._v(" "),a("p",[s._v("思考题：如果是采用数据库来实现用户的关系，一般SQL怎么写？ 例如 周標关注10个人，马化腾关注100个人，让你计算2人的共同关注那些人？")]),s._v(" "),a("p",[s._v("SQL的写法，一般是采用in 或 not in 来实现。但是对于互联网高并发的系统来说，in  not in 明显不适合。"),a("br"),s._v("\n一般的做法是采用redis的set集合来实现。"),a("br"),s._v("\nRedis Set数据结构，非常适合存储好友、关注、粉丝、感兴趣的人的集合。然后采用set的命令就能得出我们想要的数据。")]),s._v(" "),a("ol",[a("li",[s._v("sinter命令：获得A和B两个用户的共同好友")]),s._v(" "),a("li",[s._v("sismember命令：判断C是否为B的好友")]),s._v(" "),a("li",[s._v("scard命令：获取好友数量")])]),s._v(" "),a("h3",{attrs:{id:"springboot-redis-计算微博好友关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springboot-redis-计算微博好友关系"}},[s._v("#")]),s._v(" SpringBoot+Redis 计算微博好友关系")]),s._v(" "),a("p",[s._v("目标：共同关注：是计算出周標和马化腾共同关注的人有哪些？")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ApiOperation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"求2个用户的关注交集"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/intersect"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserVO")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("intersect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" userId1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" userId2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("relationService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("intersect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("userId1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("userId2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * 求2个用户的关注交集\n */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserVO")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("intersect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" userId1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" userId2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SetOperations")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" opsForSet "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" followeekey1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Constants")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CACHE_KEY_FOLLOWEE "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" userId1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" followeekey2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Constants")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CACHE_KEY_FOLLOWEE "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" userId2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//求2个集合的交集")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" sets"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" opsForSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("intersect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("followeekey1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("followeekey2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUserInfo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h4",{attrs:{id:"体验效果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#体验效果"}},[s._v("#")]),s._v(" 体验效果")]),s._v(" "),a("p",[s._v("用户和id的数据库对应关系\n周標->id=1"),a("br"),s._v("\n马化腾->id=2"),a("br"),s._v("\n王石->id=3"),a("br"),s._v("\n潘石岂->id=4")]),s._v(" "),a("p",[s._v("关注顺序\n周標关注：马化腾 王石 潘石岂\n马化腾关注：王石 潘石岂\n王石关注: 马化腾\n潘石岂关注：王石")]),s._v(" "),a("p",[s._v("微关系：\n周標和马化腾的共同关注={王石,潘石岂}")]),s._v(" "),a("h3",{attrs:{id:"实现新的功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现新的功能"}},[s._v("#")]),s._v(" 实现新的功能")]),s._v(" "),a("p",[s._v("写微关系的代码，实现微关系中的“我关注的人也关注他”功能")])])}),[],!1,null,null,null);t.default=e.exports}}]);