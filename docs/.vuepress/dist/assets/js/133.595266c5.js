(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{576:function(s,e,a){"use strict";a.r(e);var t=a(21),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"美团附近酒店搜索-技术方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#美团附近酒店搜索-技术方案"}},[s._v("#")]),s._v(" 美团附近酒店搜索-技术方案")]),s._v(" "),a("p",[s._v("自Redis 3.2开始，Redis基于geohash和zset提供了地理位置相关功能。\n什么是Geohash\nGeohash是一种地址编码，它能把二维的经纬度编码成一维的字符串。比如，世界之窗的编码是ws101xy1rp0。")]),s._v(" "),a("p",[s._v("Redis Geo模块包含了以下6个命令：")]),s._v(" "),a("h4",{attrs:{id:"geoadd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#geoadd"}},[s._v("#")]),s._v(" GEOADD")]),s._v(" "),a("p",[s._v("将给定的位置对象（纬度、经度、名字）添加到指定的key;")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('39.100.196.99:6379> geoadd hotel 113.9807127428 22.5428248089 "世界之窗" 113.9832042690 22.5408496326 "南山威尼斯酒店" 114.0684865267 22.5412294122 "福田喜来登酒店" 114.3135524539 22.5999265998 "大梅沙海景酒店" 113.9349465491 22.5305488659 "南山新年酒店" 114.0926367279 22.5497917634 "深圳华强广场酒店"\n6\n39.100.196.99:6379> zrange hotel 0 -1\n南山新年酒店\n世界之窗\n南山威尼斯酒店\n福田喜来登酒店\n深圳华强广场酒店\n大梅沙海景酒店\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("注：")]),s._v(" "),a("ol",[a("li",[s._v("这里我们采用的是中文存储，如果出现了乱码，redis命令的登录命令加上   --raw\n例如： ./redis-cli --raw")]),s._v(" "),a("li",[s._v("查看某个地址的经纬度，建议用 http://www.gpsspg.com/maps.htm，本课程就是用这个网址查出某个地址的具体经纬度")])]),s._v(" "),a("h4",{attrs:{id:"geopos"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#geopos"}},[s._v("#")]),s._v(" GEOPOS")]),s._v(" "),a("p",[s._v("从key里面返回所有给定位置对象的位置（经度和纬度）;")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('39.100.196.99:6379> GEOPOS hotel "世界之窗"\n113.98071080446243286\n22.54282525199023013\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"geohash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#geohash"}},[s._v("#")]),s._v(" GEOHASH:")]),s._v(" "),a("p",[s._v("返回一个或多个位置对象的Geohash表示;")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('39.100.196.99:6379> GEOHASH hotel "世界之窗"\nws101xy1rp0\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"geodist-key-member1-member2-unit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#geodist-key-member1-member2-unit"}},[s._v("#")]),s._v(" GEODIST key member1 member2 [unit]")]),s._v(" "),a("p",[s._v("返回两个给定位置之间的距离;\n指定单位的参数 unit 必须是以下单位的其中一个：\n-- m 表示单位为米。\n-- km 表示单位为千米。\n-- mi 表示单位为英里。\n-- ft 表示单位为英尺。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('39.100.196.99:6379> GEODIST hotel "世界之窗"  "南山威尼斯酒店" m\n337.4887\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"georadius-key-longitude-latitude-radius-m-km-ft-mi-withcoord-withdist-withhash-count-count-asc-desc-store-key-storedist-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#georadius-key-longitude-latitude-radius-m-km-ft-mi-withcoord-withdist-withhash-count-count-asc-desc-store-key-storedist-key"}},[s._v("#")]),s._v(" GEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]")]),s._v(" "),a("p",[s._v("给定一个经纬度，然后以半径为中心，计算出半径内的数据。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("39.100.196.99:6379> GEORADIUS hotel 113.9410499639 22.5461508801 10 km WITHDIST WITHCOORD count 10\n南山新年酒店\n1.8451\n113.93494695425033569\n22.53054959741555052\n世界之窗\n4.0910\n113.98071080446243286\n22.54282525199023013\n南山威尼斯酒店\n4.3704\n113.98320525884628296\n22.54085070420710224\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("-- WITHDIST: 在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。 距离的单位和用户给定的范围单位保持一致。\n-- WITHCOORD: 将位置元素的经度和维度也一并返回。\n-- WITHHASH: 以 52 位有符号整数的形式， 返回位置元素经过原始 geohash 编码的有序集合分值。 这个选项主要用于底层应用或者调试， 实际中的作用并不大。\n-- ASC、DESC\t排序方式，按照距离的 升序、降序排列\n-- STORE key1\t把结果存入key1，zset格式，以坐标hash为score\n-- STOREDIST key2\t把结果存入key2，zset格式，以距离为score")]),s._v(" "),a("h4",{attrs:{id:"georadiusbymember-key-longitude-latitude-radius-m-km-ft-mi-withcoord-withdist-withhash-count-count-asc-desc-store-key-storedist-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#georadiusbymember-key-longitude-latitude-radius-m-km-ft-mi-withcoord-withdist-withhash-count-count-asc-desc-store-key-storedist-key"}},[s._v("#")]),s._v(" GEORADIUSBYMEMBER key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]")]),s._v(" "),a("p",[s._v("GEORADIUSBYMEMBER 和 GEORADIUS 一样的功能，区别在于，GEORADIUS是以经纬度去查询，而GEORADIUSBYMEMBER是以当前集合中的某个member元素来查询")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('39.100.196.99:6379> GEORADIUSBYMEMBER hotel "世界之窗" 10 km WITHDIST WITHCOORD count 10\n世界之窗\n0.0000\n113.98071080446243286\n22.54282525199023013\n南山威尼斯酒店\n0.3375\n113.98320525884628296\n22.54085070420710224\n南山新年酒店\n4.8957\n113.93494695425033569\n22.53054959741555052\n福田喜来登酒店\n9.0190\n114.06848877668380737\n22.54122837765984144\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);