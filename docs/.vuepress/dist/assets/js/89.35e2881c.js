(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{536:function(n,s,a){"use strict";a.r(s);var e=a(21),t=Object(e.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h3",{attrs:{id:"四、采用docker安装部署nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、采用docker安装部署nginx"}},[n._v("#")]),n._v(" 四、采用docker安装部署Nginx")]),n._v(" "),a("p",[n._v("在主机192.168.1.138下，安装nginx，docker 的安装命令如下：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("docker  run \\\n-d \\\n-p 8080:80 \\\n--name session-nginx \\\nnginx\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br")])]),a("ul",[a("li",[a("p",[n._v("-d：在后台运行")])]),n._v(" "),a("li",[a("p",[n._v("-p：容器的80端口映射到物理机的8080端口")])]),n._v(" "),a("li",[a("p",[n._v("--name：容器的名字为session-nginx")])]),n._v(" "),a("li",[a("p",[n._v("关于为什么要用docker安装？"),a("br"),n._v("\n因为用docker安装非常方便，docker安装1分钟不到就安装完，如果用传统安装，会各自安装包和命令，\n最起码需要10分钟才能安装完。所以建议大家用docker安装。")])])]),n._v(" "),a("p",[n._v("体验:http://192.168.1.138:8080/")]),n._v(" "),a("h3",{attrs:{id:"五、采用docker部署nginx的集群负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、采用docker部署nginx的集群负载均衡"}},[n._v("#")]),n._v(" 五、采用docker部署Nginx的集群负载均衡")]),n._v(" "),a("h4",{attrs:{id:"步骤1-在物理机建3个文件夹目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤1-在物理机建3个文件夹目录"}},[n._v("#")]),n._v(" 步骤1：在物理机建3个文件夹目录")]),n._v(" "),a("ul",[a("li",[n._v("/data/volume/nginx/www    存放nginx的静态文件")]),n._v(" "),a("li",[n._v("/data/volume/nginx/config 存放nginx的配置文件")]),n._v(" "),a("li",[n._v("/data/volume/nginx/logs   存放nginx的日志")])]),n._v(" "),a("h4",{attrs:{id:"步骤2-把nginx容器的配置文件拷贝出来"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤2-把nginx容器的配置文件拷贝出来"}},[n._v("#")]),n._v(" 步骤2：把nginx容器的配置文件拷贝出来")]),n._v(" "),a("p",[n._v("命令如下：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("docker cp session-nginx:/etc/nginx/nginx.conf /data/volume/nginx/config/\ndocker cp session-nginx:/etc/nginx/conf.d/default.conf /data/volume/nginx/config/\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br")])]),a("h4",{attrs:{id:"步骤3-修改nginx的集群负载均衡配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤3-修改nginx的集群负载均衡配置文件"}},[n._v("#")]),n._v(" 步骤3：修改nginx的集群负载均衡配置文件")]),n._v(" "),a("p",[n._v("为达到负载均衡目的，需要修改主机配置文件/data/volume/nginx/config/default.conf")]),n._v(" "),a("ul",[a("li",[n._v("server外部追加，")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("upstream web {\n      server 192.168.1.8:9090;\n      server 192.168.1.8:9091; \n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br")])]),a("p",[n._v("192.168.1.8代表Springboot用户登录服务部署主机")]),n._v(" "),a("ul",[a("li",[n._v("server里边增加")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("location = / {\n      proxy_pass http://web;\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br")])]),a("p",[n._v("修改后 完整的default.conf源码，如下：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("upstream web {\n      server 192.168.1.8:9090;\n      server 192.168.1.8:9091;\n}\n\nserver {\n    listen       80;\n    server_name  localhost;\n\n    #charset koi8-r;\n    #access_log  /var/log/nginx/host.access.log  main;\n\n    location / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n        proxy_pass http://web;\n    }\n\n    #error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n    # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n    #\n    #location ~ \\.php$ {\n    #    proxy_pass   http://127.0.0.1;\n    #}\n\n    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n    #\n    #location ~ \\.php$ {\n    #    root           html;\n    #    fastcgi_pass   127.0.0.1:9000;\n    #    fastcgi_index  index.php;\n    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n    #    include        fastcgi_params;\n    #}\n\n    # deny access to .htaccess files, if Apache's document root\n    # concurs with nginx's one\n    #\n    #location ~ /\\.ht {\n    #    deny  all;\n    #}\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br")])]),a("h4",{attrs:{id:"步骤4-启动nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤4-启动nginx"}},[n._v("#")]),n._v(" 步骤4：启动nginx")]),n._v(" "),a("ul",[a("li",[a("p",[n._v("删除原先安装的nginx容器，不然会报错\ndocker rm -f session-nginx")])]),n._v(" "),a("li",[a("p",[n._v("启动nginx容器")])])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("docker  run \\\n-d \\\n-p 8080:80 \\\n--name session-nginx \\\n-v /data/volume/nginx/www:/usr/share/nginx/html \\\n-v /data/volume/nginx/config/default.conf:/etc/nginx/conf.d/default.conf \\\n-v /data/volume/nginx/config/nginx.conf:/etc/nginx/nginx.conf \\\n-v /data/volume/nginx/logs:/var/log/nginx \\\nnginx\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br")])]),a("p",[n._v("-v的意思就是把目标目录，映射到容器文件目录，例如：把容器的/var/log/nginx目录映射到主机的/data/volume/nginx/logs目录")]),n._v(" "),a("h3",{attrs:{id:"剖析springboot-nginx的分布式session不一致性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#剖析springboot-nginx的分布式session不一致性"}},[n._v("#")]),n._v(" 剖析SpringBoot+Nginx的分布式Session不一致性")]),n._v(" "),a("h4",{attrs:{id:"步骤1-启动springboot用户登录服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤1-启动springboot用户登录服务"}},[n._v("#")]),n._v(" 步骤1：启动SpringBoot用户登录服务")]),n._v(" "),a("p",[n._v("把Springboot用户登录服务，启动2个服务，端口分别为9090和 9091")]),n._v(" "),a("h4",{attrs:{id:"步骤2-用ie体验效果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤2-用ie体验效果"}},[n._v("#")]),n._v(" 步骤2：用IE体验效果")]),n._v(" "),a("p",[n._v("http://192.168.1.138:8080/user/login?username=agan1&password=agan1\nhttp://192.168.1.138:8080/user/find/agan1")]),n._v(" "),a("p",[n._v("结论：")]),n._v(" "),a("ol",[a("li",[n._v("用户第一次访问Nginx，请求落到了服务器A，服务器A生成了一个sessionId,并保存在用户的cookie中。")]),n._v(" "),a("li",[n._v("用户第二次再来访问Nginx，它这次把cookie里面的sessionId加入http的请求头中，这时请求落到了服务器B，服务器B发现没有找到sessionId,于是创建了一个新的sessionId并保存在用户的cookie中。\n以上2个步骤，在分布式系统中，必将导致session错乱。")])])])}),[],!1,null,null,null);s.default=t.exports}}]);