(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{465:function(e,t,r){"use strict";r.r(t);var a=r(21),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h4",{attrs:{id:"dubbo架构原理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#dubbo架构原理"}},[e._v("#")]),e._v(" Dubbo架构原理")]),e._v(" "),r("h5",{attrs:{id:"步骤一、下载zooinspector工具"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#步骤一、下载zooinspector工具"}},[e._v("#")]),e._v(" 步骤一、下载ZooInspector工具")]),e._v(" "),r("p",[e._v("为了探索dubbo的架构，我们需要去下载ZooInspector工具"),r("br"),e._v(" "),r("a",{attrs:{href:"https://issues.apache.org/jira/secure/attachment/12436620/ZooInspector.zip"}},[e._v("download ZooInspector")]),e._v("\n下载完成后，我们需要进入build目录执行")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("java -jar zookeeper-dev-ZooInspector.jar\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("先启动本地或者远程的ZooKeeper服务，然后打开我们的ZooInspector的工具如下:\n"),r("img",{attrs:{src:"/dubbo/ZooInspector.png",alt:"image"}}),e._v("\n我们打开后，选择左上角绿色按钮来建立ZooKeeper监听，然后只需要填写ZooKeeper服务端的地址就可以了，这个工具能够非常直观的看到那些服务连接到ZooKeeper上了")]),e._v(" "),r("h4",{attrs:{id:"步骤二、启动dubbo-demo代码"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#步骤二、启动dubbo-demo代码"}},[e._v("#")]),e._v(" 步骤二、启动dubbo-demo代码")]),e._v(" "),r("p",[e._v("我们启动dubbo-demo-xml-provider，然后我们刷新ZooInspector的连接，会发现多了一个dubbo的文件夹\n"),r("img",{attrs:{src:"/dubbo/dubbo-provider.png",alt:"image"}}),e._v("\n可以看到dubbo-demo-provider启动后，会给每一个被注册的接口，生成文件夹，其中包括"),r("code",[e._v("configurators")]),e._v(" 和 "),r("code",[e._v("providers")])]),e._v(" "),r("p",[e._v("我们从idea的console控制台可以看到如下日志:\nGreetingService")]),e._v(" "),r("div",{staticClass:"language-xml line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-xml"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("\x3c!-- 将接口注册到注册中心 --\x3e")]),e._v("\n Register: dubbo://192.168.0.101:20880/cn.ityoudream.dubbo.GreetingService?anyhost=true&application=demo-provider&deprecated=false&dubbo=2.0.2&dynamic=true&generic=false&group=greeting&interface=cn.ityoudream.dubbo.GreetingService&mapping-type=metadata&mapping.type=metadata&methods=hello&pid=845&release=2.7.5&revision=1.0.0&side=provider&timeout=5000&timestamp=1610857314899&version=1.0.0, dubbo version: 2.7.5, current host: 192.168.0.101\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("\x3c!-- 订阅configurators的动态配置--\x3e")]),e._v("\nSubscribe: provider://192.168.0.101:20880/cn.ityoudream.dubbo.GreetingService?anyhost=true&application=demo-provider&bind.ip=192.168.0.101&bind.port=20880&category=configurators&check=false&deprecated=false&dubbo=2.0.2&dynamic=true&generic=false&group=greeting&interface=cn.ityoudream.dubbo.GreetingService&mapping-type=metadata&mapping.type=metadata&methods=hello&pid=845&qos.port=22222&release=2.7.5&revision=1.0.0&side=provider&timeout=5000&timestamp=1610857314899&version=1.0.0, dubbo version: 2.7.5, current host: 192.168.0.101\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("\x3c!-- 刷新自己的缓存，configurators动态配置 --\x3e")]),e._v("\nNotify urls for subscribe url provider://192.168.0.101:20880/cn.ityoudream.dubbo.GreetingService?anyhost=true&application=demo-provider&bind.ip=192.168.0.101&bind.port=20880&category=configurators&check=false&deprecated=false&dubbo=2.0.2&dynamic=true&generic=false&group=greeting&interface=cn.ityoudream.dubbo.GreetingService&mapping-type=metadata&mapping.type=metadata&methods=hello&pid=845&qos.port=22222&release=2.7.5&revision=1.0.0&side=provider&timeout=5000&timestamp=1610857314899&version=1.0.0, urls: [empty://192.168.0.101:20880/cn.ityoudream.dubbo.GreetingService?anyhost=true&application=demo-provider&bind.ip=192.168.0.101&bind.port=20880&category=configurators&check=false&deprecated=false&dubbo=2.0.2&dynamic=true&generic=false&group=greeting&interface=cn.ityoudream.dubbo.GreetingService&mapping-type=metadata&mapping.type=metadata&methods=hello&pid=845&qos.port=22222&release=2.7.5&revision=1.0.0&side=provider&timeout=5000&timestamp=1610857314899&version=1.0.0], dubbo version: 2.7.5, current host: 192.168.0.101\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br")])]),r("p",[e._v("从上面日志中，我们发现provider启动的时候，会把所有接口注册到注册中心，并且订阅动态配置"),r("code",[e._v("configurators")])]),e._v(" "),r("p",[e._v("启动dubbo-demo-xml-consumer，然后我们使用ZooInspector，发现：\n"),r("img",{attrs:{src:"/dubbo/dubbo-consumer.png",alt:"image"}}),e._v("\ndubbo里面多了consumers,routers,configurators")]),e._v(" "),r("p",[e._v("我们看一下consumer服务到启动日志")]),e._v(" "),r("div",{staticClass:"language-xml line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-xml"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("\x3c!-- 启动时候，建立长连接(consumer发送到provider使用netty发送)，然后进行数据通信 --\x3e")]),e._v("\nSuccessed connect to server /192.168.0.101:20880 from NettyClient 192.168.0.101 using dubbo version 2.7.5, channel is NettyChannel [channel=[id: 0x380e556c, L:/192.168.0.101:51602 - R:/192.168.0.101:20880]], dubbo version: 2.7.5, current host: 192.168.0.101\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("\x3c!-- 往注册中心注册 --\x3e")]),e._v("\n Register: consumer://192.168.0.101/org.apache.dubbo.monitor.MonitorService?application=demo-consumer&category=consumers&check=false&dubbo=2.0.2&enable-auto-migration=true&enable.auto.migration=true&interface=org.apache.dubbo.monitor.MonitorService&mapping-type=metadata&mapping.type=metadata&pid=1437&release=2.7.5&timestamp=1610869049774, dubbo version: 2.7.5, current host: 192.168.0.101\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("\x3c!-- 启动时候订阅providers,configurators,routers --\x3e")]),e._v("\n\nSubscribe: consumer://192.168.0.101/org.apache.dubbo.monitor.MonitorService?application=demo-consumer&category=providers,configurators,routers&dubbo=2.0.2&enable-auto-migration=true&enable.auto.migration=true&interface=org.apache.dubbo.monitor.MonitorService&mapping-type=metadata&mapping.type=metadata&pid=1437&release=2.7.5&timestamp=1610869049774, dubbo version: 2.7.5, current host: 192.168.0.101\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("\x3c!-- 订阅内容变更时候，会推送category=providers,configurators订阅信息 --\x3e")]),e._v("\n Notify urls for subscribe url consumer://192.168.0.101/org.apache.dubbo.monitor.MonitorService?application=demo-consumer&category=providers,configurators,routers&dubbo=2.0.2&enable-auto-migration=true&enable.auto.migration=true&interface=org.apache.dubbo.monitor.MonitorService&mapping-type=metadata&mapping.type=metadata&pid=1437&release=2.7.5&timestamp=1610869049774, urls: [empty://192.168.0.101/org.apache.dubbo.monitor.MonitorService?application=demo-consumer&category=providers&dubbo=2.0.2&enable-auto-migration=true&enable.auto.migration=true&interface=org.apache.dubbo.monitor.MonitorService&mapping-type=metadata&mapping.type=metadata&pid=1437&release=2.7.5&timestamp=1610869049774, empty://192.168.0.101/org.apache.dubbo.monitor.MonitorService?application=demo-consumer&category=configurators&dubbo=2.0.2&enable-auto-migration=true&enable.auto.migration=true&interface=org.apache.dubbo.monitor.MonitorService&mapping-type=metadata&mapping.type=metadata&pid=1437&release=2.7.5&timestamp=1610869049774, empty://192.168.0.101/org.apache.dubbo.monitor.MonitorService?application=demo-consumer&category=routers&dubbo=2.0.2&enable-auto-migration=true&enable.auto.migration=true&interface=org.apache.dubbo.monitor.MonitorService&mapping-type=metadata&mapping.type=metadata&pid=1437&release=2.7.5&timestamp=1610869049774], dubbo version: 2.7.5, current host: 192.168.0.101\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br")])]),r("p",[e._v("我们根据dubbo启动和ZooInspector工具分析dubbo，可以画出如下dubbo的原理图:\n"),r("img",{attrs:{src:"/dubbo/dubbo%E6%9E%B6%E6%9E%84.png",alt:"image"}})]),e._v(" "),r("h4",{attrs:{id:"源码下载"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#源码下载"}},[e._v("#")]),e._v(" 源码下载")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://github.com/zhoubiao188/apache-dubbo-source\n"}},[e._v("github download apache-dubbo-source")])])])}),[],!1,null,null,null);t.default=o.exports}}]);